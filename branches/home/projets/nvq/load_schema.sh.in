#!/bin/bash

################################################################################
#
# Shell script to create the layers tables that will receive Navstreets data
# Tables are created empty then appended during load to prevent non-existing layers
# to generate load error.
#
################################################################################

# These variables will be replaced by configuration values after running apply_config.sh
DBHOST=%DBHOST%
DBPORT=%DBPORT%
DBNAME=%DBNAME%
DBUSER=%DBUSER%
DBPASS=%DBPASS%
DATADIR=%DATADIR%
PGBIN=%PGBIN%
PROJDIR=%PROJDIR%

echo
echo "Loading dictionary tables (codes, enums, etc.)"
echo

${PGBIN}psql -q $PGCON -d $DBNAME -c "copy li_chain_name (chainid, chain_name, description) from '$PROJDIR/nvq/data/chain_name' with (format CSV, header true)"

${PGBIN}psql -q $PGCON -d $DBNAME -c "copy li_country_chain_name (country, country_gov_code, description, facility_type, chain_name, chainid) from '$PROJDIR/data/country_and_chain_name.csv' with (format CSV, header true)"

${PGBIN}psql -q $PGCON -d $DBNAME -c "copy li_family_brand_name (family_chainid, family_brand_name, description, chain_name, chainid) from '$PROJDIR/nvq/data/family_brand_name.csv' with (format CSV, header true)"

${PGBIN}psql -q $PGCON -d $DBNAME -c "copy class_code from '$PRODIR/nvq/data/class_code.csv' with (format CSV, header false, delimiter ';')"

echo
echo "Loading Navteq layers structure"
echo
${PGBIN}shp2pgsql $PGCON -D -p -s 4326 -g the_geom -t 2D $DATADIR/EMEA/FRANCE_ANDORRA/F1AM12400EF1000AABCE/Adminbndy2.shp adminbndy2 | ${PGBIN}psql -q $PGCON $DBNAME
${PGBIN}shp2pgsql $PGCON -D -p -s 4326 -g the_geom -t 2D $DATADIR/EMEA/FRANCE_ANDORRA/F1AM12400EF1000AABCE/Adminbndy3.shp adminbndy3 | ${PGBIN}psql -q $PGCON $DBNAME
${PGBIN}shp2pgsql $PGCON -D -p -s 4326 -g the_geom -t 2D $DATADIR/EMEA/FRANCE_ANDORRA/F1AM12400EF1000AABCE/Adminbndy4.shp adminbndy4 | ${PGBIN}psql -q $PGCON $DBNAME
${PGBIN}shp2pgsql $PGCON -D -p -s 4326 -g the_geom -t 2D $DATADIR/EMEA/FRANCE_ANDORRA/F1AM12400EF1000AABCE/Adminbndy5.shp adminbndy5 | ${PGBIN}psql -q $PGCON $DBNAME

echo "  >> tables structure loaded"
echo