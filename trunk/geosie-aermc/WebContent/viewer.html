<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" lang="fr"
      dir="ltr">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="robots" content="noindex" />
        <meta http-equiv="pragma" content="no-cache" />
        <title>GEOSIE : Page de visualisation</title>

        <link rel="stylesheet" href="lib/OpenLayers/theme/default/style.css"
              type="text/css" media="print,screen" />
        <link rel="stylesheet" href="style/viewer.css" type="text/css"
              media="print,screen" />
        <link rel="stylesheet" href="style/main.css" type="text/css"
              media="print,screen" />
        <link rel="stylesheet" href="style/dialog.css" type="text/css"
              media="print,screen" />
        <link rel="stylesheet" href="style/layerListLegendStyle.css"
              type="text/css" media="print,screen" />
        <!--		<link rel="stylesheet" href="style/legendStyle.css" type="text/css" media="print,screen" />-->
        <link rel="stylesheet" href="style/gazetteerStyle.css" type="text/css"
              media="print,screen" />
        <link rel="stylesheet" href="style/custoStyles.css" type="text/css"
              media="print,screen" />
        <link rel="stylesheet" href="style/controlPanel.css" type="text/css"
              media="print,screen" />

        <!-- jQuery 1.3.2 -->
        <script type="text/javascript" src="lib/jQuery/jquery.min.js"></script>
        <script type="text/javascript" src="lib/jQuery/jquery-ui.min.js"></script>
        <script type="text/javascript" src="lib/jQuery/jquery.autocomplete.pack.js"></script>
        <script type="text/javascript" src="lib/jQuery/jquery.form.js"></script>

        <!-- Proj4js -->
        <script type="text/javascript" src="lib/Proj4js/proj4js-compressed.js"></script>

        <!-- Debug with Firebug and Firefox -->
        <!--<script src="lib/OpenLayers/lib/Firebugs/firebug.js"></script>-->

        <!-- OpenLayers 2.10 -->
        <!--script type="text/javascript" src="lib/OpenLayers/OpenLayers.js"></script-->
        <!--script type="text/javascript" src="lib/OpenLayers/ol-debug.js"></script-->
        <script type="text/javascript" src="js/OpenLayers.debug.js"></script>

        <!-- GeoSIE -->
        <script type="text/javascript" src="lib/GeoSIE/GeoSIE.js"></script>
        <script type="text/javascript" src="lib/GeoSIE/Proj4jsdefs.js"></script>
        <script type="text/javascript" src="lib/GeoSIE/Config.js"></script>
        <script type="text/javascript" src="lib/GeoSIE/Messages.js"></script>
        <script type="text/javascript" src="lib/GeoSIE/Util.js"></script>
        <script type="text/javascript" src="lib/GeoSIE/Brique.js"></script>
        <script type="text/javascript" src="lib/GeoSIE/FeatureList.js"></script>
        <script type="text/javascript" src="lib/GeoSIE/LayerListLegend.js"></script>
        <!--		<script type="text/javascript" src="lib/GeoSIE/LayerList.js"></script>	-->
        <!--		<script type="text/javascript" src="lib/GeoSIE/Legend.js"></script>	-->

        <script type="text/javascript" src="lib/GeoSIE/Gazetteer.js"></script>
        <script type="text/javascript" src="lib/GeoSIE/CrsSelector.js"></script>
        <script type="text/javascript" src="lib/GeoSIE/GoTo.js"></script>
        <script type="text/javascript" src="lib/GeoSIE/ZoneManager.js"></script>
        <script type="text/javascript" src="lib/GeoSIE/WpsManager.js"></script>

        <script type="text/javascript" src="lib/GeoSIE/Control/Print.js"></script>
        <script type="text/javascript" src="lib/GeoSIE/Control/EditPoint.js"></script>
        <script type="text/javascript" src="lib/GeoSIE/Control/EditLine.js"></script>
        <script type="text/javascript" src="lib/GeoSIE/Control/EditPolygon.js"></script>
        <script type="text/javascript" src="lib/GeoSIE/Control/WfsGetFeature.js"></script>
        <script type="text/javascript" src="lib/GeoSIE/Control/DragFeature.js"></script>
        <script type="text/javascript" src="lib/GeoSIE/Control/LoadingPanel.js"></script>
        <script type="text/javascript" src="lib/GeoSIE/Control/ScaleCombo.js"></script>
        <script type="text/javascript" src="lib/GeoSIE/Control/ZoomBar.js"></script>
        <script type="text/javascript" src="lib/GeoSIE/Control/Copyrights.js"></script>
        <script type="text/javascript" src="lib/GeoSIE/Control/NavigationHistory.js"></script>
        <script type="text/javascript" src="lib/GeoSIE/Control/ZoneSelector.js"></script>
        <script type="text/javascript" src="lib/GeoSIE/Control/WpsGetFeature.js"></script>
        <script type="text/javascript" src="lib/GeoSIE/Control/WpsSelector.js"></script>
        <script type="text/javascript" src="lib/GeoSIE/Control/WpsDownload.js"></script>
        <script type="text/javascript" src="lib/GeoSIE/Control/SnappingSIE.js"></script>
        <script type="text/javascript" src="lib/GeoSIE/Control/Snapping.js"></script>
        <script type="text/javascript" src="lib/GeoSIE/Control/FullScreen.js"></script>
        <script type="text/javascript" src="lib/GeoSIE/Control/Link.js"></script>
        <script type="text/javascript" src="lib/GeoSIE/Control/Measure.js"></script>

        <!-- Business (bouchon) -->
        <script type="text/javascript" src="js/Business.js"></script>

        <!-- Surcharge AERMC: conf -->

        <script type="text/javascript">
            OpenLayers.console = function (o) {
                console.log(o);
            };
            ////////////////////////////////////////////////////////////////////////////////
            // URL du service WFS. A adapter suivant le contexte: machine distant, locale...
            //wfsURL = "http://aermc:8180/cgi-bin/mapserv?map=/carto/demo_maquette.map";
            wfsURL = "http://aermc/cgi-bin/mapserv?map=/carto/demo_maquette.map";
            var ouvrageLayer = null, selectCtrl = null;
            ////////////////////////////////////////////////////////////////////////////////
            
            // global settings
            OpenLayers.ImgPath = "style/images/";
            OpenLayers.ProxyHost = "proxy?url=";
            OpenLayers.IMAGE_RELOAD_ATTEMPTS = 3;
            OpenLayers.Util.onImageLoadErrorColor = "green";
            
            //window.onload = function() {
            $(document).ready(function() {
                GeoSIE.Brique.init();
                Business.init();
                // open the layerlistlegend
                if($("#accordion")) {
                    $("#accordion").accordion({
                        header: "h3",
                        fillSpace: true
                    });
                }
                //});
            
                // ajout d'une couche vectorielle type WFS
                // ses attributs
                propertyNames = ["gid", "numouv","numcomloc","msGeometry"];
                // la couche
                ouvrageLayer = new OpenLayers.Layer.Vector("Ouvrages", {
                    opacity: 1,
                    strategies: [new OpenLayers.Strategy.BBOX()], 
                    projection: new OpenLayers.Projection("EPSG:2154"),
                    protocol: new OpenLayers.Protocol.WFS({
                        "url": wfsURL,
                        "propertyNames": propertyNames,
                        "geometryName": "msGeometry",
                        "featureType": "ouvrages",
                        "featurePrefix": "ms",
                        "srsName": "EPSG:2154",
                        "maxFeatures": 1000,
                        "version": "1.0.0"
                    })
                });
                
                // control sur la couche:
                selectCtrl = new OpenLayers.Control.SelectFeature(ouvrageLayer, {
                    clickout: true,
                    toggle: false,
                    multiple: false,
                    hover: false,
                    toggleKey: "ctrlKey", // ctrl key removes from selection
                    multipleKey: "shiftKey", // shift key adds to selection
                    box: false
                });
                GeoSIE.Brique.map.addControl(selectCtrl);
                // event de fin de chargement: zoom et Z index réglés la.
                ouvrageLayer.events.register("loadend", ouvrageLayer, function (e) {
                    console.log("loadend on ouvrageLayer");
                    GeoSIE.Brique.map.zoomTo(this.getDataExtent());
                    
                    // affichage au sommet pour les events:
                    ouvrageLayer.setZIndex(1000);
                    
                    //console.log(selectCtrl);
                    selectCtrl.activate();
                });
                
                // feature selected
                ouvrageLayer.events.register("featureselected", ouvrageLayer, function (e) {
                    console.log("featureselected on ouvrageLayer: ");
                    console.log(e.feature);
                });
                // feature unselected
                ouvrageLayer.events.register("featureunselected", ouvrageLayer, function (e) {
                    console.log("featureUNselected on ouvrageLayer: " + e.feature);
                });
                
                //GeoSIE.Brique.map.addLayer(ouvrageLayer);

            });
            
            function showOuvragesInfo() {
                console.log("showOuvragesInfo..");
            }
        </script>
    </head>
    <body style="width: 100%;">
        <div id="headerdiv">
            <div id="leftbg">
                <!--a target="_blank" title="Eaufrance, le portail de l'information sur l'eau" href="http://www.eaufrance.fr">
                        <img alt="Eaufrance, le portail de l'information sur l'eau"
                        class="logoImage" src="images/bg_left.jpg"
                        title="Eaufrance, le portail de l'information sur l'eau">			
                </a-->
                <a target="_blank" title="Agende de l'eau Rh&ocirc;ne M&eacute;dit&e&eacute;ran&eacute;e et Corse" href="http://www.aermc.fr">
                    <img alt="aermc" class="logoImage" src="images/logo-aermc.jpeg" title="AERMC" height="93">			
                </a>
            </div>
            <div id="rightbg"></div>
            <div id="middlebg">
                <div
                    style="padding: 15px 0px 5px 15px; font-size: 18px; font-weight: bold; color: #23678C;">GEOSIE</div>
                <div
                    style="padding: 0px 0px 0px 15px; color: #58595B; font-size: 12px; font-weight: bold;">Démonstrateur
                    de la brique cartographique, intégration dans le cadre de l'AERMC</div>
            </div>
        </div>

        <div id="index">
            <div id="container_geosie_brique">
                <div class="container_geosie_brique_border"></div>
                <div class="container_geosie_brique_content">
                    <div id="button" style="z-index: 2000">
                        <div id="navigationTitle">Navigation</div>
                        <div id="navigationButtonBar">
                            <div id="navigationButtonBar_panel" class="olControlPanel"></div>
                        </div>
                        <div id="editionTitle">Mode édition</div>
                        <div id="editionButtonBar">
                            <div id="editionButtonBar_panel" class="olControlPanel"></div>
                        </div>					
                        <div id="processTitle">Traitement</div>
                        <div id="processButtonBar">
                            <div id="processButtonBar_panel" class="olControlPanel"></div>
                        </div>
                        <div id="otherButtonBar">
                            <div id="otherButtonBar_panel" class="olControlPanelOther"></div>
                        </div>					
                    </div>
                    <div id="others" style="z-index: 3000;">
                        <div id="scale"></div>
                        <div id="zones"></div>
                        <div id="processes">
                            <dl class="dropdownWps" id="wpsList"></dl>
                        </div>
                    </div>
                    <div id="map" style="z-index: 1000">
                        <div id="mainMapPane" style="z-index: 1100;">
                            <noscript>this page requires Javascript to be enabled
                            </noscript>
                            <div id="olmap"></div>
                            <div id="locatorContainer">
                                <div id="locatorMap"></div>
                                <div id="zoomBar"></div>
                                <div id="hideLocator">
                                    <img src="images/locator_on.png" class="hideovm1" id="hide1"
                                         alt="" title="Fermer la mini carte" />
                                </div>
                            </div>
                            <div id="status_loading_container">
                                <div id="status_loading">
                                    <img src="images/wait.gif" style="display: inline" />&nbsp;Chargement
                                </div>
                            </div>
                            <div id="scalebar"></div>
                            <div id="mapFooter">
                                <div id="cursorTrack"></div>
                                <div id="crsSelector" style="position: absolute; left: 42%;"></div>
                                <div id="sourceTrack"></div>
                            </div>
                        </div>
                        <div id="accordion" style="z-index: 1100">
                            <div class="accordiontweak" style="z-index: 60">
                                <h3>
                                    <center> <a href="#">&nbsp;Données</a> </center>
                                </h3>
                                <div id="layerListLegend" class="accordiontweak-content"></div>
                            </div>
                            <!--                    <div class="accordiontweak" style="z-index:60">-->
                            <!--                        <h3><center><a href="#">&nbsp;Données</a></center></h3>-->
                            <!--                        <div id="layerList" class="accordiontweak-content"></div>-->
                            <!--                    </div>-->
                            <!--                    <div class="accordiontweak" style="z-index:70">-->
                            <!--                        <h3><center><a href="#">&nbsp;Légende</a></center></h3>-->
                            <!--                        <div id="legend" class="accordiontweak-content"></div>-->
                            <!--                    </div>-->
                            <div class="accordiontweak" style="z-index: 80">
                                <h3>
                                    <center> <a href="#">&nbsp;Aller à ...</a> </center>
                                </h3>
                                <div id="gazetteer" class="accordiontweak-content"></div>
                            </div>
                            <div class="accordiontweak" style="z-index: 400"
                                 id="accordion_results">
                                <h3>
                                    <center> <a href="#">&nbsp;Résultat</a> </center>
                                </h3>
                                <div id="featureList" class="accordiontweak-content"></div>
                            </div>

                        </div>
                    </div>
                </div>
                <div id="containerForm" style="display: block;"></div>
                <!--  div style="border-bottom: 1px dashed rgb(63, 100, 160); color: rgb(63, 100, 160);"></div-->

                <!-- Dialog's Div -->
                <div id="dialog" style="display: none;">
                    <div id="dialogContent"></div>
                </div>
                <div id="dialogPrint" style="display: none;">
                    <div id="dialogPrintContent"></div>
                </div>
                <div id="dialogWps" style="display: none;">
                    <div id="dialogWpsContent"></div>
                </div>
                <div id="dialogGetFeatureInfo" style="display: none;">
                    <div id="dialogGetFeatureInfoContent"></div>
                </div>
                <div id="dialogWpsDownload" style="display: none;">
                    <div id="dialogWpsDownloadContent"></div>
                </div>
                <!--			<div id="featureList"></div>-->

                <div id="opaque"></div>
            </div>
            <div class="mentionsLegales"><a target="_blank" title="Mentions légales" href="http://www.onema.fr">Mentions légales</a>&nbsp;<a target="_blank" title="Avertissement général" href="http://www.onema.fr">Avertissement général</a></div>
        </div>
    </body>
</html>